# 哔哩哔哩收藏夹失效内容清理工具

这是一个简单易用的工具，用于一键清理哔哩哔哩账号所有收藏夹中的失效内容。

## 功能特点

- 自动获取所有收藏夹列表
- 批量清理每个收藏夹中的失效内容
- 显示清理进度和结果统计
- 包含错误处理和请求限制
- 支持配置文件管理用户信息
- 提供友好的交互式启动器
- 集成Cookie获取助手，简化配置过程
- 支持多种Cookie获取方式（二维码登录、手动输入等）
- 自动检查配置完整性和有效性

## 使用方法

### 1. 环境要求

- Node.js 12.0 或更高版本

### 2. 快速开始（推荐）

使用启动器，提供友好的交互界面：

```bash
node start.js
```

或者使用npm脚本（如果已安装package.json）：

```bash
npm start
```

启动器会提供以下选项：
1. 开始清理收藏夹
2. 配置Cookie信息
3. 查看当前配置
4. 查看使用说明
5. 退出

### 3. Cookie配置方式

#### 方式一：使用Cookie获取助手（推荐）
```bash
node cookie_helper.js
```

或者使用npm脚本：

```bash
npm run config
```

提供多种获取Cookie的方式：
- 自动打开哔哩哔哩登录页面，引导手动获取
- 使用在线二维码登录工具
- 直接手动输入Cookie

#### 方式二：手动配置
1. 打开浏览器，登录哔哩哔哩
2. 按F12打开开发者工具
3. 切换到Network标签
4. 刷新页面
5. 找到任意一个bilibili.com的请求，查看Request Headers
6. 复制完整的Cookie值，填入 `config.json` 文件

### 4. 直接运行清理工具

如果已配置好Cookie，可以直接运行：

```bash
node bilibili_fav_cleaner_with_config.js
```

或者使用npm脚本：

```bash
npm run clean
```

### 5. 文件说明

- `start.js` - 主启动器，提供友好的用户界面
- `cookie_helper.js` - Cookie获取助手，简化配置过程
- `bilibili_fav_cleaner_with_config.js` - 主清理工具
- `config.json` - 配置文件，存储Cookie信息
- `package.json` - 项目配置文件，包含npm脚本
- `README.md` - 详细说明文档

### 6. npm脚本说明

- `npm start` - 启动主界面
- `npm run clean` - 直接运行清理工具
- `npm run config` - 运行Cookie配置助手

## 输出示例

### 启动器界面
```
=== 哔哩哔哩收藏夹清理工具 ===
版本: 2.0
功能: 一键清理所有收藏夹中的失效内容

=== 主菜单 ===
✅ 配置状态: 已配置，可以使用

请选择操作：
1. 开始清理收藏夹
2. 配置Cookie信息
3. 查看当前配置
4. 查看使用说明
5. 退出
```

### 清理工具输出
```
=== 哔哩哔哩收藏夹失效内容清理工具 ===
用户ID: 35291489
开始获取收藏夹列表...
获取到 5 个收藏夹

正在清理收藏夹: 动漫收藏 (ID: 123456, 视频数: 150)
✓ 清理完成

正在清理收藏夹: 音乐收藏 (ID: 789012, 视频数: 80)
✓ 清理完成

=== 清理完成 ===
成功清理: 5 个收藏夹
清理失败: 0 个收藏夹
```

### Cookie获取助手界面
```
=== 哔哩哔哩Cookie获取助手 ===
请选择获取Cookie的方式：
1. 打开哔哩哔哩登录页面（手动获取）
2. 使用在线二维码登录工具
3. 手动输入Cookie
4. 查看当前配置
5. 退出
```

## 配置文件说明

`config.json` 文件包含以下字段：

- `up_mid`: 你的哔哩哔哩用户ID
- `csrf_token`: CSRF令牌，用于POST请求验证
- `cookie`: 完整的Cookie字符串，包含SESSDATA、bili_jct和DedeUserID

## 安全说明

- 脚本仅使用哔哩哔哩公开的API接口
- 不会获取或修改您的任何私人信息
- 仅清理失效内容，不会删除有效的收藏
- 建议在非高峰时段使用，避免对服务器造成压力
- 每个请求之间添加1秒延迟，避免请求过快

## 故障排除

### 常见问题

1. **获取收藏夹列表失败**
   - 检查Cookie信息是否正确
   - 确认网络连接正常
   - 检查是否已正确登录哔哩哔哩

2. **清理失败**
   - 确认CSRF令牌是否正确
   - 检查收藏夹是否存在
   - 查看错误信息进行排查

3. **配置文件问题**
   - 确认JSON格式是否正确
   - 检查所有必需字段是否已填写
   - 确认文件权限是否正确

### 调试模式

如需查看详细的API返回信息，可以修改代码中的日志级别，在清理函数中添加调试输出。

## 技术实现

- 使用Node.js原生HTTPS模块发送请求
- 通过哔哩哔哩API接口获取收藏夹列表和执行清理操作
- 采用异步处理和错误机制确保稳定性
- 支持配置文件管理，避免硬编码敏感信息

## API接口

- 获取收藏夹列表：`https://api.bilibili.com/x/v3/fav/folder/created/list-all`
- 清理失效内容：`https://api.bilibili.com/x/v3/fav/resource/clean`

## 许可证

本项目仅供学习和个人使用，请勿用于商业用途。

## 免责声明

使用本工具所产生的任何后果由用户自行承担，开发者不对因使用本工具造成的任何损失负责。
