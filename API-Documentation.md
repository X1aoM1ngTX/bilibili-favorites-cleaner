# Bilibili æ”¶è—å¤¹æ¸…ç†å·¥å…· API æ–‡æ¡£

æœ¬æ–‡æ¡£åŸºäº bilibili-favorites-cleaner é¡¹ç›®é€†å‘åˆ†æå¾—å‡ºçš„æ‰€æœ‰ API æ¥å£ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœ¬åœ°åç«¯æ¥å£å’Œ Bilibili åŸå§‹ APIã€‚

## ç›®å½•

- [æœ¬åœ°åç«¯ API æ¥å£](#æœ¬åœ°åç«¯-api-æ¥å£)
- [Bilibili åŸå§‹ API æ¥å£](#bilibili-åŸå§‹-api-æ¥å£)
- [é€šç”¨è¯·æ±‚å¤´ä¿¡æ¯](#é€šç”¨è¯·æ±‚å¤´ä¿¡æ¯)
- [é”™è¯¯å¤„ç†è¯´æ˜](#é”™è¯¯å¤„ç†è¯´æ˜)

---

## æœ¬åœ°åç«¯ API æ¥å£

### 1. é…ç½®ç®¡ç†æ¥å£ (`/api/config`)

#### è·å–é…ç½®ä¿¡æ¯
- **URL**: `GET /api/config`
- **åŠŸèƒ½**: è·å–å½“å‰ä¿å­˜çš„ç”¨æˆ·é…ç½®ä¿¡æ¯
- **å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "up_mid": "ç”¨æˆ·UID",
    "csrf_token": "CSRFä»¤ç‰Œ",
    "cookie": "å®Œæ•´Cookieå­—ç¬¦ä¸²"
  }
}
```

#### ä¿å­˜é…ç½®ä¿¡æ¯
- **URL**: `POST /api/config`
- **åŠŸèƒ½**: ä¿å­˜ç”¨æˆ·é…ç½®ä¿¡æ¯
- **è¯·æ±‚ä½“**:
```json
{
  "up_mid": "ç”¨æˆ·UID",
  "csrf_token": "CSRFä»¤ç‰Œ",
  "cookie": "å®Œæ•´Cookieå­—ç¬¦ä¸²"
}
```

#### åˆ é™¤é…ç½®ä¿¡æ¯
- **URL**: `DELETE /api/config`
- **åŠŸèƒ½**: åˆ é™¤å½“å‰é…ç½®ä¿¡æ¯

---

### 2. æ”¶è—å¤¹ç®¡ç†æ¥å£ (`/api/favorites`)

#### è·å–æ”¶è—å¤¹åˆ—è¡¨
- **URL**: `GET /api/favorites`
- **åŠŸèƒ½**: è·å–ç”¨æˆ·æ‰€æœ‰çš„æ”¶è—å¤¹åˆ—è¡¨
- **Bilibili API**: `GET https://api.bilibili.com/x/v3/fav/folder/created/list-all?up_mid={uid}`

#### è·å–æ”¶è—å¤¹è¯¦æƒ…
- **URL**: `GET /api/favorites/:id`
- **åŠŸèƒ½**: è·å–æŒ‡å®šæ”¶è—å¤¹çš„è¯¦ç»†ä¿¡æ¯å’Œè§†é¢‘åˆ—è¡¨
- **å‚æ•°**: `id` - æ”¶è—å¤¹ID
- **Bilibili API**: `GET https://api.bilibili.com/x/v3/fav/resource/list?media_id={id}&pn=1&ps=20`

---

### 3. Cookie è½¬æ¢æ¥å£ (`/api/convert`)

#### Cookie æ ¼å¼è½¬æ¢
- **URL**: `POST /api/convert`
- **åŠŸèƒ½**: å°† Cookie è½¬æ¢ä¸º TinyDB æ ¼å¼
- **è¯·æ±‚ä½“**:
```json
{
  "cookies": "Cookieå­—ç¬¦ä¸²æˆ–Cookieæ•°ç»„"
}
```
- **å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "_default": {
      "1": {
        "value": [
          {
            "name": "SESSDATA",
            "value": "å€¼",
            "domain": ".bilibili.com",
            "path": "/",
            "expires": æ—¶é—´æˆ³,
            "httpOnly": true,
            "secure": true,
            "sameSite": "Lax"
          }
        ]
      }
    }
  }
}
```

---

### 4. æ¸…ç†æ¥å£ (`/api/clean`)

#### æ¸…ç†å•ä¸ªæ”¶è—å¤¹
- **URL**: `POST /api/clean`
- **åŠŸèƒ½**: æ¸…ç†æŒ‡å®šæ”¶è—å¤¹ä¸­çš„å¤±æ•ˆå†…å®¹
- **è¯·æ±‚ä½“**:
```json
{
  "mediaId": "æ”¶è—å¤¹ID"
}
```
- **Bilibili API**: `POST https://api.bilibili.com/x/v3/fav/resource/clean`

#### æ‰¹é‡æ¸…ç†æ”¶è—å¤¹
- **URL**: `POST /api/clean/batch`
- **åŠŸèƒ½**: æ‰¹é‡æ¸…ç†å¤šä¸ªæ”¶è—å¤¹ä¸­çš„å¤±æ•ˆå†…å®¹
- **è¯·æ±‚ä½“**:
```json
{
  "mediaIds": ["æ”¶è—å¤¹ID1", "æ”¶è—å¤¹ID2"]
}
```

---

### 5. ç§»åŠ¨æ¥å£ (`/api/move`)

#### è·å–æ”¶è—å¤¹ä¿¡æ¯
- **URL**: `GET /api/move/info/:mediaId`
- **åŠŸèƒ½**: è·å–æŒ‡å®šæ”¶è—å¤¹çš„è¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…æ‹¬è§†é¢‘æ€»æ•°ï¼‰
- **å‚æ•°**: `mediaId` - æ”¶è—å¤¹ID

#### è®¡ç®—å¯ç§»åŠ¨è§†é¢‘æ•°é‡
- **URL**: `GET /api/move/calculate`
- **åŠŸèƒ½**: è®¡ç®—å¯ä»¥ä»æºæ”¶è—å¤¹ç§»åŠ¨åˆ°ç›®æ ‡æ”¶è—å¤¹çš„è§†é¢‘æ•°é‡
- **æŸ¥è¯¢å‚æ•°**:
  - `srcMediaId` - æºæ”¶è—å¤¹ID
  - `tarMediaId` - ç›®æ ‡æ”¶è—å¤¹ID
- **é™åˆ¶**: æ¯ä¸ªæ”¶è—å¤¹æœ€å¤š 1000 ä¸ªè§†é¢‘

#### è·å–æ”¶è—å¤¹å‰Nä¸ªè§†é¢‘
- **URL**: `GET /api/move/videos/:mediaId`
- **åŠŸèƒ½**: è·å–æŒ‡å®šæ”¶è—å¤¹å‰Nä¸ªè§†é¢‘ï¼ˆæŒ‰æ”¶è—æ—¶é—´å€’åºï¼‰
- **å‚æ•°**: `mediaId` - æ”¶è—å¤¹ID
- **æŸ¥è¯¢å‚æ•°**: `count` - è·å–çš„è§†é¢‘æ•°é‡

#### æ‰§è¡Œè§†é¢‘ç§»åŠ¨
- **URL**: `POST /api/move/execute`
- **åŠŸèƒ½**: å°†è§†é¢‘ä»æºæ”¶è—å¤¹ç§»åŠ¨åˆ°ç›®æ ‡æ”¶è—å¤¹
- **è¯·æ±‚ä½“**:
```json
{
  "srcMediaId": "æºæ”¶è—å¤¹ID",
  "tarMediaId": "ç›®æ ‡æ”¶è—å¤¹ID"
}
```
- **Bilibili API**: `POST https://api.bilibili.com/x/v3/fav/resource/move`

---

### 6. æ’åºæ¥å£ (`/api/sort`)

#### è·å–å¯æ’åºçš„æ”¶è—å¤¹åˆ—è¡¨
- **URL**: `GET /api/sort/folders`
- **åŠŸèƒ½**: è·å–ç”¨æˆ·æ‰€æœ‰çš„æ”¶è—å¤¹åˆ—è¡¨ï¼Œç”¨äºæ’åº
- **Bilibili API**: `GET https://api.bilibili.com/x/v3/fav/folder/created/list-all?up_mid={uid}`

#### æ‰§è¡Œæ”¶è—å¤¹æ’åº
- **URL**: `POST /api/sort/execute`
- **åŠŸèƒ½**: æŒ‰ç…§æŒ‡å®šçš„é¡ºåºé‡æ–°æ’åˆ—æ”¶è—å¤¹
- **è¯·æ±‚ä½“**:
```json
{
  "folderIds": ["æ”¶è—å¤¹ID1", "æ”¶è—å¤¹ID2"]
}
```
- **è§„åˆ™**: é»˜è®¤æ”¶è—å¤¹å¿…é¡»åœ¨ç¬¬ä¸€ä½ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- **Bilibili API**: `POST https://api.bilibili.com/x/v3/fav/folder/sort`

---

## Bilibili åŸå§‹ API æ¥å£

### 1. æ”¶è—å¤¹åˆ—è¡¨è·å–

#### è·å–æ‰€æœ‰åˆ›å»ºçš„æ”¶è—å¤¹
- **URL**: `GET https://api.bilibili.com/x/v3/fav/folder/created/list-all`
- **æ–¹æ³•**: GET

**è¯·æ±‚å‚æ•°**:
| å‚æ•°å | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|--------|------|------|------|
| `up_mid` | string | âœ… | ç”¨æˆ·UIDï¼Œå³Bç«™ç”¨æˆ·å”¯ä¸€æ ‡è¯† |

**è¯·æ±‚å¤´è¦æ±‚**:
```
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36
Referer: https://www.bilibili.com/
Origin: https://www.bilibili.com
Cookie: [ç”¨æˆ·å®Œæ•´Cookie]
```

**å“åº”å­—æ®µè¯¦è§£**:
```json
{
  "code": 0,
  "message": "0",
  "ttl": 1,
  "data": {
    "count": 62, //ä¸€ä¸ªå¤šå°‘ä¸ªæ”¶è—å¤¹
    "list": [
      {
        "id": 1234567890,           // æ”¶è—å¤¹IDï¼ˆmedia_idï¼‰
        "fid": 12345678,          // æ–‡ä»¶å¤¹IDï¼Œè§‚å¯Ÿåˆ°æ˜¯idå»æ‰å2ä½æ•°å­—,æ¯”å¦‚idæ˜¯1234567890ï¼Œfidæ˜¯12345678
        "mid": 98765432,          // æ”¶è—å¤¹åˆ›å»ºè€…UID
        "title": "æˆ‘çš„æ”¶è—å¤¹",   // æ”¶è—å¤¹æ ‡é¢˜
        "attr": 0,              // å±æ€§ï¼š0-é»˜è®¤æ”¶è—å¤¹ï¼Œ2æˆ–è€…22-æ™®é€šæ”¶è—å¤¹ï¼Œ3-ç§å¯†æ”¶è—å¤¹
        "fav_state": 0,             // çŠ¶æ€ï¼š0-æ­£å¸¸ï¼Œ1-åˆ é™¤
        "media_count": 100,     // æ”¶è—å¤¹å†…è§†é¢‘æ•°é‡
      },
      {
        "id": 1296746589,
        "fid": 12967465,
        "mid": 35291489,
        "attr": 22,
        "title": "ğŸ˜å§å§ä»” I",
        "fav_state": 0,
        "media_count": 999
      }
    ],
    "season": null
  }
}
```

### 2. æ”¶è—å¤¹å†…å®¹è·å–

#### è·å–æ”¶è—å¤¹èµ„æºåˆ—è¡¨
- **URL**: `GET https://api.bilibili.com/x/v3/fav/resource/list`
- **æ–¹æ³•**: GET

**è¯·æ±‚å‚æ•°è¯¦è§£**:
| å‚æ•°å | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| `media_id` | number | âœ… | - | æ”¶è—å¤¹ID |
| `pn` | number | âŒ | 1 | é¡µç ï¼Œä»1å¼€å§‹ |
| `ps` | number | âŒ | 40 | æ¯é¡µæ•°é‡ï¼Œæœ€å¤§40 |
| `keyword` | string | âŒ | "" | æœç´¢å…³é”®è¯ï¼Œæ”¯æŒæ ‡é¢˜å’ŒUPä¸»æœç´¢ |
| `order` | string | âŒ | "mtime" | æ’åºæ–¹å¼ï¼šmtime-æœ€è¿‘æ”¶è—ï¼Œpubtime-æœ€è¿‘æŠ•ç¨¿ï¼Œview-æœ€å¤šæ’­æ”¾ |
| `type` | number | âŒ | 0 | 0-åœ¨å½“å‰æ”¶è—å¤¹ä¸­æœç´¢ï¼Œ1-åœ¨å…¨éƒ¨æ”¶è—å¤¹ä¸­æœç´¢ |
| `tid` | number | âŒ | 0 | ï¼Ÿ |
| `platform` | string | âŒ | "web" | å¹³å°æ ‡è¯† |
| `web_location` | string | âŒ | "333.1387" | ç½‘é¡µä½ç½®æ ‡è¯†ç¬¦ |

**è¯·æ±‚å¤´è¦æ±‚**:
```
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36
Referer: https://www.bilibili.com/
Origin: https://www.bilibili.com
Cookie: [ç”¨æˆ·å®Œæ•´Cookie]
```

**å“åº”å­—æ®µè¯¦è§£**:
```json
{
  "code": 0,
  "message": "0",
  "ttl": 1,
  "data": {
    "info": {
      "id": 3120664789, // æ”¶è—å¤¹ID
      "fid": 31206647, // æ–‡ä»¶å¤¹IDï¼Œè§‚å¯Ÿåˆ°æ˜¯idå»æ‰å2ä½æ•°å­—
      "mid": 35291489, // æ”¶è—å¤¹åˆ›å»ºè€…UID
      "attr": 3, // æ”¶è—å¤¹ç±»å‹
      "title": "äºº,å“²å­¦,æ”¿æ²»,ç¤¾ä¼š", // æ”¶è—å¤¹æ ‡é¢˜
      "cover": "http://i2.hdslb.com/bfs/archive/6b6a2ac6c7fbae2b9ad140e830dc15aa4ae5b6b5.jpg", // æ”¶è—å¤¹å°é¢ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨è®¾ç½®ï¼Œé»˜è®¤ä¸ºæ”¶è—å¤¹ç¬¬ä¸€ä¸ªè§†é¢‘çš„å°é¢
      "upper": {
        "mid": 35291489, //  ç”¨æˆ·UID
        "name": "åƒå¤œã®è©©", // ç”¨æˆ·æ˜µç§°
        "face": "https://i2.hdslb.com/bfs/face/d9eb65858b67558cec4520b08a4a6eaa02cfba8f.jpg", // ç”¨æˆ·å¤´åƒåœ°å€
        "followed": false,
        "vip_type": 2, // 1å¤§ä¼šå‘˜ 2å¹´åº¦å¤§ä¼šå‘˜
        "vip_statue": 1 // å¤§ä¼šå‘˜çŠ¶æ€ 1æ˜¯ 0å¦
      },
      "cover_type": 2,
      "cnt_info": {
        "collect": 0,
        "play": 0,
        "thumb_up": 0,
        "share": 0
      },
      "type": 11,
      "intro": "",
      "ctime": 1713105444,
      "mtime": 1724399325,
      "state": 0,
      "fav_state": 0,
      "like_state": 0,
      "media_count": 82,
      "is_top": false
    },
    "medias": [
      {
        "id": 115462914445096, // è§†é¢‘BVå·å¯¹åº”çš„æ•°å­—ID
        "type": 2, 
        "title": "1å°æ—¶40åˆ†é’Ÿä¼šè°ˆï¼Œç¾å›½ä¸‰æ¬¡è®©æ­¥ï¼Œåˆ°åº•éƒ½è°ˆäº†ä»€ä¹ˆ",// è§†é¢‘æ ‡é¢˜
        "cover": "http://i1.hdslb.com/bfs/archive/60c8f34b6445920e895c6b0c2e601a88ddeec552.jpg", // è§†é¢‘å°é¢å›¾ç‰‡
        "intro": "",// è§†é¢‘ç®€ä»‹
        "page": 1,
        "duration": 655,// è§†é¢‘æ—¶é•¿ï¼ˆç§’
        "upper": {
          "mid": 2495818,
          "name": "æ±Ÿå¹³èˆŸ",
          "face": "https://i1.hdslb.com/bfs/face/b251cdccf2ec14f453f5d1e07248d48aa0c23204.jpg",
          "jump_link": ""
        },
        "attr": 0,
        "cnt_info": {
          "collect": 7849,
          "play": 1399656,
          "danmaku": 5111,
          "vt": 0,
          "play_switch": 0,
          "reply": 0,
          "view_text_1": "139.9ä¸‡"
        },
        "link": "bilibili://video/115462914445096",
        "ctime": 1761824347,
        "pubtime": 1761824347,// å‘å¸ƒæ—¶é—´æˆ³
        "fav_time": 1761840565,// æ”¶è—æ—¶é—´æˆ³
        "bv_id": "BV1WeyYB5ENH",// è§†é¢‘BVå·
        "bvid": "BV1WeyYB5ENH",// è§†é¢‘BVå·
        "season": null,
        "ogv": null,
        "ugc": {
          "first_cid": 33530709358
        },
        "media_list_link": "bilibili://music/playlist/playpage/3155956189?page_type=3&oid=115462914445096&otype=2"
      },
    ],
    "has_more": true,
    "ttl": 1762661206
  }
}
```

### 3. æ”¶è—å¤¹æ¸…ç†

#### æ¸…ç†å¤±æ•ˆèµ„æº
- **æ–‡ä»¶ä½ç½®**: [clean.js:21](new/backend/routes/clean.js#L21)
- **URL**: `POST https://api.bilibili.com/x/v3/fav/resource/clean`
- **æ–¹æ³•**: POST

**è¯·æ±‚å‚æ•°è¯¦è§£**:
| å‚æ•°å | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|--------|------|------|------|
| `media_id` | number | âœ… | æ”¶è—å¤¹ID |
| `platform` | string | âœ… | å›ºå®šå€¼ï¼š"web" |
| `csrf` | string | âœ… | CSRFä»¤ç‰Œï¼Œä»Cookieä¸­çš„bili_jctè·å– |

**è¯·æ±‚å¤´è¦æ±‚**:
```
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36
Referer: https://www.bilibili.com/
Origin: https://www.bilibili.com
Cookie: [ç”¨æˆ·å®Œæ•´Cookieï¼Œå¿…é¡»åŒ…å«bili_jct]
Content-Type: application/x-www-form-urlencoded
```

**POST è¯·æ±‚ä½“æ ¼å¼**:
```
media_id=123456&platform=web&csrf=abc123def456
```

**å“åº”å­—æ®µè¯¦è§£**:
```json
{
  "code": 0,                    // çŠ¶æ€ç ï¼š0-æˆåŠŸï¼Œé0-å¤±è´¥
  "message": "success",         // çŠ¶æ€æ¶ˆæ¯
  "data": 5                     // æ¸…ç†çš„å¤±æ•ˆèµ„æºæ•°é‡
}
```

**å¸¸è§é”™è¯¯å“åº”**:
```json
{
  "code": -111,                 // é”™è¯¯ä»£ç ï¼š-111è¡¨ç¤ºcsrfæ ¡éªŒå¤±è´¥
  "message": "csrfæ ¡éªŒå¤±è´¥"      // é”™è¯¯ä¿¡æ¯
}
```

### 4. æ”¶è—å¤¹ç§»åŠ¨

#### ç§»åŠ¨è§†é¢‘åˆ°å…¶ä»–æ”¶è—å¤¹
- **URL**: `POST https://api.bilibili.com/x/v3/fav/resource/move`
- **æ–¹æ³•**: POST

**è¯·æ±‚å‚æ•°è¯¦è§£**:
| å‚æ•°å | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|--------|------|------|------|
| `resources` | string | âœ… | èµ„æºåˆ—è¡¨ï¼Œæ ¼å¼ï¼š`è§†é¢‘ID1:2,è§†é¢‘ID2:2`ï¼ˆID:ç±»å‹ï¼Œè§†é¢‘ç±»å‹ä¸º2ï¼‰ |
| `src_media_id` | number | âœ… | æºæ”¶è—å¤¹ID |
| `tar_media_id` | number | âœ… | ç›®æ ‡æ”¶è—å¤¹ID |
| `mid` | string | âœ… | ç”¨æˆ·UID |
| `platform` | string | âœ… | å›ºå®šå€¼ï¼š"web" |
| `csrf` | string | âœ… | CSRFä»¤ç‰Œï¼Œä»Cookieä¸­çš„bili_jctè·å– |

**è¯·æ±‚å¤´è¦æ±‚**:
```
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36
Referer: https://www.bilibili.com/
Origin: https://www.bilibili.com
Cookie: [ç”¨æˆ·å®Œæ•´Cookieï¼Œå¿…é¡»åŒ…å«bili_jct]
Content-Type: application/x-www-form-urlencoded
```

**POST è¯·æ±‚ä½“ç¤ºä¾‹**:
```
resources=987654321:2,123456789:2&src_media_id=111111&tar_media_id=222222&mid=123456789&platform=web&csrf=abc123def456
```

**resources å‚æ•°æ ¼å¼è¯´æ˜**:
- å•ä¸ªèµ„æºï¼š`è§†é¢‘ID:2`ï¼ˆ2 è¡¨ç¤ºè§†é¢‘ç±»å‹ï¼‰
- å¤šä¸ªèµ„æºï¼š`è§†é¢‘ID1:2,è§†é¢‘ID2:2,è§†é¢‘ID3:2`ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰
- ç¤ºä¾‹ï¼š`987654321:2,123456789:2` è¡¨ç¤ºç§»åŠ¨ä¸¤ä¸ªè§†é¢‘

**å“åº”å­—æ®µè¯¦è§£**:
```json
{
  "code": 0,                    // çŠ¶æ€ç ï¼š0-æˆåŠŸï¼Œé0-å¤±è´¥
  "message": "success",         // çŠ¶æ€æ¶ˆæ¯
  "ttl": 1,
  "data": 0                    // 0è¡¨ç¤ºæˆåŠŸ
}
```

**é™åˆ¶è¯´æ˜**:
- æ¯ä¸ªæ”¶è—å¤¹æœ€å¤šå®¹çº³ 1000 ä¸ªè§†é¢‘
- ç§»åŠ¨å‰éœ€è¦æ£€æŸ¥ç›®æ ‡æ”¶è—å¤¹å®¹é‡
- ä¸€æ¬¡ç§»åŠ¨ 20 ä¸ªèµ„æºï¼ˆå»ºè®®å€¼ï¼‰æœ€å¤š40

### 5. æ”¶è—å¤¹æ’åº

#### æ’åºæ”¶è—å¤¹
- **URL**: `POST https://api.bilibili.com/x/v3/fav/folder/sort`
- **æ–¹æ³•**: POST

**è¯·æ±‚å‚æ•°è¯¦è§£**:
| å‚æ•°å | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|--------|------|------|------|
| `sort` | string | âœ… | æ”¶è—å¤¹IDæ’åºåˆ—è¡¨ï¼Œç”¨é€—å·åˆ†éš” |
| `csrf` | string | âœ… | CSRFä»¤ç‰Œï¼Œä»Cookieä¸­çš„bili_jctè·å– |

**è¯·æ±‚å¤´è¦æ±‚**:
```
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36
Referer: https://space.bilibili.com/[ç”¨æˆ·UID]/favlist
Origin: https://space.bilibili.com
Cookie: [ç”¨æˆ·å®Œæ•´Cookieï¼Œå¿…é¡»åŒ…å«bili_jct]
Content-Type: application/x-www-form-urlencoded
Accept: application/json, text/plain, */*
Accept-Language: zh-CN,zh-HK;q=0.9,zh;q=0.8,en-US;q=0.7,en;q=0.6
Priority: u=1, i
Sec-Ch-Ua: "Google Chrome";v="141", "Not?A_Brand";v="8", "Chromium";v="141"
Sec-Ch-Ua-Mobile: ?0
Sec-Ch-Ua-Platform: "Windows"
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```

**POST è¯·æ±‚ä½“ç¤ºä¾‹**:
```
sort=111111,222222,333333&csrf=abc123def456
```

**sort å‚æ•°æ ¼å¼è¯´æ˜**:
- æ”¶è—å¤¹IDæŒ‰ç›®æ ‡æ’åºé¡ºåºæ’åˆ—ï¼Œç”¨é€—å·åˆ†éš”
- é»˜è®¤æ”¶è—å¤¹å¿…é¡»æ’åœ¨ç¬¬ä¸€ä½ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- ç¤ºä¾‹ï¼šåŸæ¥æ˜¯`222222,111111,333333` æ”¹æˆ `111111,222222,333333` è¡¨ç¤ºæŒ‰`111111,222222,333333`çš„é¡ºåºæ’åˆ—ä¸‰ä¸ªæ”¶è—å¤¹

**å“åº”å­—æ®µè¯¦è§£**:
```json
{
  "code": 0,                    // çŠ¶æ€ç ï¼š0-æˆåŠŸï¼Œé0-å¤±è´¥
  "message": "success",         // çŠ¶æ€æ¶ˆæ¯
  "ttl": 1,
  "data": {}                    // ç©ºå¯¹è±¡è¡¨ç¤ºæ’åºæˆåŠŸ
}
```

**æ’åºè§„åˆ™è¯´æ˜**:
- é»˜è®¤æ”¶è—å¤¹ï¼ˆattr=0ï¼‰å¿…é¡»ä½äºç¬¬ä¸€ä½
- ç”¨æˆ·åˆ›å»ºçš„æ”¶è—å¤¹å¯ä»¥ä»»æ„æ’åº
- ä¸€æ¬¡æ’åºæœ€å¤šæ”¯æŒ 20 ä¸ªæ”¶è—å¤¹
- æ’åºåç«‹å³ç”Ÿæ•ˆï¼Œå‰ç«¯éœ€è¦é‡æ–°è·å–åˆ—è¡¨

**å¸¸è§é”™è¯¯å“åº”**:
```json
{
  "code": -111,                 // é”™è¯¯ä»£ç ï¼š-111è¡¨ç¤ºcsrfæ ¡éªŒå¤±è´¥
  "message": "csrfæ ¡éªŒå¤±è´¥"      // é”™è¯¯ä¿¡æ¯
}
```

```json
{
  "code": -101,                 // é”™è¯¯ä»£ç ï¼š-101è¡¨ç¤ºæœªç™»å½•
  "message": "è´¦å·æœªç™»å½•"         // é”™è¯¯ä¿¡æ¯
}
```

---

## é€šç”¨è¯·æ±‚å¤´ä¿¡æ¯

### æ‰€æœ‰ Bilibili API è°ƒç”¨éƒ½éœ€è¦åŒ…å«ä»¥ä¸‹é€šç”¨è¯·æ±‚å¤´ï¼š

```
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36
Referer: https://www.bilibili.com/
Origin: https://www.bilibili.com
Cookie: [å®Œæ•´çš„ç”¨æˆ·Cookie]
```

### å¯¹äºæŸäº›ç‰¹å®šæ¥å£ï¼Œè¿˜å¯èƒ½éœ€è¦é¢å¤–çš„è¯·æ±‚å¤´ï¼š

```
Accept: application/json, text/plain, */*
Accept-Language: zh-CN,zh-HK;q=0.9,zh;q=0.8,en-US;q=0.7,en;q=0.6
Priority: u=1, i
Sec-Ch-Ua: "Google Chrome";v="141", "Not?A_Brand";v="8", "Chromium";v="141"
Sec-Ch-Ua-Mobile: ?0
Sec-Ch-Ua-Platform: "Windows"
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```

---

## é”™è¯¯å¤„ç†è¯´æ˜

### Bilibili API æ ‡å‡†å“åº”æ ¼å¼ï¼š

```json
{
  "code": 0,                    // int, çŠ¶æ€ç ï¼š0-æˆåŠŸï¼Œè´Ÿæ•°-é”™è¯¯ï¼Œæ­£æ•°-è­¦å‘Š
  "message": "success",         // string, çŠ¶æ€æ¶ˆæ¯æè¿°
  "data": {}                    // object/array/string/number, å®é™…æ•°æ®å†…å®¹
}
```

**å“åº”å­—æ®µè¯¦è§£**:
- `code`: çŠ¶æ€ç 
  - `0`: æ“ä½œæˆåŠŸ
  - `-101`: è´¦å·æœªç™»å½•æˆ–Cookieå¤±æ•ˆ
  - `-111`: csrfæ ¡éªŒå¤±è´¥ï¼Œé€šå¸¸æ˜¯ç”±äºbili_jctä»¤ç‰Œé”™è¯¯æˆ–è¿‡æœŸ
  - `-112`: è®¿é—®æƒé™ä¸è¶³ï¼Œå¯èƒ½æ— æƒè®¿é—®è¯¥æ”¶è—å¤¹
  - `-113`: è´¦å·è¢«å°ç¦
  - `-404`: èµ„æºä¸å­˜åœ¨ï¼Œæ”¶è—å¤¹IDæˆ–è§†é¢‘IDæ— æ•ˆ
  - `-400`: è¯·æ±‚å‚æ•°é”™è¯¯ï¼Œå‚æ•°æ ¼å¼æˆ–å€¼ä¸æ­£ç¡®
  - `-500`: Bç«™æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
  - `-509`: è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¢«é™æµ

- `message`: çŠ¶æ€æ¶ˆæ¯ï¼Œæä¾›é”™è¯¯æˆ–æˆåŠŸçš„è¯¦ç»†ä¿¡æ¯
- `data`: å“åº”æ•°æ®ï¼Œæ ¹æ®ä¸åŒçš„APIè¿”å›ä¸åŒçš„æ•°æ®ç»“æ„

### é€šç”¨é”™è¯¯å¤„ç†ç­–ç•¥ï¼š

#### 1. è®¤è¯ç›¸å…³é”™è¯¯ (-101, -111)
```json
{
  "code": -101,
  "message": "è´¦å·æœªç™»å½•",
  "data": null
}
```

**å¤„ç†å»ºè®®**:
- æ£€æŸ¥Cookieæ˜¯å¦è¿‡æœŸ
- é‡æ–°ç™»å½•è·å–æ–°çš„Cookie
- éªŒè¯SESSDATAæ˜¯å¦æœ‰æ•ˆ

```json
{
  "code": -111,
  "message": "csrfæ ¡éªŒå¤±è´¥",
  "data": null
}
```

**å¤„ç†å»ºè®®**:
- ä»Cookieä¸­é‡æ–°æå–bili_jctå€¼
- æ£€æŸ¥Cookieæ ¼å¼æ˜¯å¦æ­£ç¡®
- ç¡®ä¿æ‰€æœ‰POSTè¯·æ±‚éƒ½åŒ…å«csrfå‚æ•°

#### 2. æƒé™ç›¸å…³é”™è¯¯ (-112)
```json
{
  "code": -112,
  "message": "è®¿é—®æƒé™ä¸è¶³",
  "data": null
}
```

**å¤„ç†å»ºè®®**:
- ç¡®è®¤æ˜¯å¦æœ‰è¯¥æ”¶è—å¤¹çš„è®¿é—®æƒé™
- æ£€æŸ¥æ”¶è—å¤¹æ˜¯å¦ä¸ºç§å¯†æ”¶è—å¤¹
- éªŒè¯ç”¨æˆ·èº«ä»½æ˜¯å¦æ­£ç¡®

#### 3. å‚æ•°ç›¸å…³é”™è¯¯ (-400, -404)
```json
{
  "code": -400,
  "message": "è¯·æ±‚å‚æ•°é”™è¯¯",
  "data": null
}
```

**å¤„ç†å»ºè®®**:
- æ£€æŸ¥æ‰€æœ‰å¿…éœ€å‚æ•°æ˜¯å¦æä¾›
- éªŒè¯å‚æ•°ç±»å‹å’Œæ ¼å¼æ˜¯å¦æ­£ç¡®
- ç¡®è®¤å‚æ•°å€¼æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…

```json
{
  "code": -404,
  "message": "èµ„æºä¸å­˜åœ¨",
  "data": null
}
```

**å¤„ç†å»ºè®®**:
- éªŒè¯media_idæ˜¯å¦æœ‰æ•ˆ
- æ£€æŸ¥æ”¶è—å¤¹æ˜¯å¦å·²åˆ é™¤
- ç¡®è®¤è§†é¢‘IDæ˜¯å¦å­˜åœ¨

### HTTP çŠ¶æ€ç å¯¹åº”å…³ç³»ï¼š

| HTTPçŠ¶æ€ç  | Bç«™API code | è¯´æ˜ |
|-----------|-------------|------|
| 200 | 0 | è¯·æ±‚æˆåŠŸ |
| 200 | -101 ~ -113 | ä¸šåŠ¡é”™è¯¯ï¼Œä½†HTTPè¯·æ±‚æˆåŠŸ |
| 400 | -400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | -101 | æœªè®¤è¯ |
| 403 | -112 | æƒé™ä¸è¶³ |
| 404 | -404 | èµ„æºä¸å­˜åœ¨ |
| 429 | -509 | è¯·æ±‚è¿‡äºé¢‘ç¹ |
| 500 | -500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

### æœ¬åœ°åç«¯é”™è¯¯å“åº”æ ¼å¼ï¼š

```json
{
  "success": false,             // boolean, æ“ä½œæ˜¯å¦æˆåŠŸ
  "error": "é”™è¯¯æè¿°ä¿¡æ¯"        // string, æœ¬åœ°åç«¯è¿”å›çš„é”™è¯¯ä¿¡æ¯
}
```

**å¸¸è§æœ¬åœ°åç«¯é”™è¯¯**:
- é…ç½®ç¼ºå¤±é”™è¯¯
- CookieéªŒè¯å¤±è´¥
- å‚æ•°éªŒè¯é”™è¯¯
- ç½‘ç»œè¯·æ±‚è¶…æ—¶
- æ•°æ®è§£æå¤±è´¥

### å»ºè®®çš„é”™è¯¯å¤„ç†æµç¨‹ï¼š

1. **é¦–å…ˆæ£€æŸ¥HTTPçŠ¶æ€ç **
2. **è§£æBç«™APIå“åº”ä¸­çš„codeå­—æ®µ**
3. **æ ¹æ®ä¸åŒé”™è¯¯ç±»å‹é‡‡å–ç›¸åº”æªæ–½**
4. **è®°å½•é”™è¯¯æ—¥å¿—ç”¨äºè°ƒè¯•**
5. **å‘ç”¨æˆ·æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º**

---

## é‡è¦è¯´æ˜

1. **è®¤è¯è¦æ±‚**: æ‰€æœ‰ Bilibili API è°ƒç”¨éƒ½éœ€è¦æœ‰æ•ˆçš„ç”¨æˆ· Cookie
2. **CSRF ä¿æŠ¤**: æ¶‰åŠæ•°æ®ä¿®æ”¹çš„æ“ä½œéœ€è¦æä¾› CSRF token (bili_jct)
3. **é¢‘ç‡é™åˆ¶**: å»ºè®®æ§åˆ¶ API è°ƒç”¨é¢‘ç‡ï¼Œé¿å…è¢«é™åˆ¶
4. **æ•°æ®å®‰å…¨**: Cookie åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œè¯·å¦¥å–„ä¿ç®¡
5. **æ”¶è—å¤¹é™åˆ¶**: æ¯ä¸ªæ”¶è—å¤¹æœ€å¤šå¯å®¹çº³ 1000 ä¸ªè§†é¢‘

---

*æœ¬æ–‡æ¡£åŸºäº bilibili-favorites-cleaner é¡¹ç›® new ç‰ˆæœ¬åˆ†æç”Ÿæˆï¼Œæœ€åæ›´æ–°æ—¶é—´ï¼š2025å¹´11æœˆ9æ—¥*